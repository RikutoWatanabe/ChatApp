<html>
<head>
	<meta charset="UTF-8">
	<title> RiushiruChats</title>
</head>
<body>
	<p> Chat room of Rikushiru </p>
	user name<input type="text" id="user_input" style="width:100px;"/>
	<button onclick="publishChangeUsername();">change</button><br>
	message<input type="text" id="msg_input" style="width:200px;" />
	<button onclick="publishMessage();">send</button>
	<div style = "width:50%; height:70%; overflow-y:scroll;">
	<div id="msg"></div>
	<script src="/socket.io/socket.io.js"></script>
	<script	type="text/javascript">
	alert("Welcome to Chatroom!");
	var socketio = io.connect();
	socketio.on("connected" , function(name) {});
	socketio.on("publish",function (data) {addMessage(data.value);});
	socketio.on("disconnect" , function () {});


	function start(name) {
      socketio.emit("connected", name);
    }
    function publishChangeUsername() {
    	var textInput = document.getElementById('user_input');
    	var msg = "[" + myName + "] were changed user neme to [" + textInput.value +"]";
    	myName = textInput.value; 
    	socketio.emit("change", textInput.value , {value: msg});
    }

    function publishMessage() {
      var textInput = document.getElementById('msg_input');
      var msg = "[" + myName + "] " + textInput.value;
      socketio.emit("publish", {value: msg});
      textInput.value = '';
    }

    function addMessage (msg) {
      var domMeg = document.createElement('div');
      domMeg.innerHTML = new Date().toLocaleTimeString() + ' ' + msg;
      msgArea.appendChild(domMeg);
    }

	var msgArea = document.getElementById("msg");
	var myName = Math.floor(Math.random()*100);
	addMessage("Welcome your join. You are name is [" + myName + "]");
	start(myName);
	</script>
	</div>
</body>
</html>

